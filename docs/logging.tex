\documentclass[11pt]{article}
\usepackage[margin=1.2in]{geometry}
\usepackage{color,soul,hyperref,url}
\usepackage{graphicx,amstext}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{paralist}

\lstset{
  basicstyle=\ttfamily,
  breaklines=true
}

\newcommand{\simspec}{simulation_spec.json}
\newcommand{\logfile}{simulations_1_14-Oct-2013_15.56.06.txt}

\begin{document}
	
\title{Logging}
\author{
  Elaine Wah \\
  \href{mailto:ewah@umich.edu}{ewah@umich.edu}
}
\date{Updated: \today}
\maketitle

\section{File Location}

All log files are saved in the folder \path{logs} that is created in the
directory that contains the \path{simulation_spec.json} file.  Logs (.txt
files) are named according the following convention: There are four sections in
the filename, each separated by underscores (examples refer to the filename
\path{simulations_1_14-Oct-2013_15.56.06.txt}):

\begin{description}
\item[Directory or path] with the spec file, with forward slashes replaced by
  hyphens (e.g., the base directory is \path{simulations/test})
\item[Observation number] (e.g., here it is observation \#2)
\item[Date] (dd-MMM-YYYY format)
\item[Time] (hh.mm.ss format, 24-hour clock, e.g., time here is 1:45:00 PM)
\end{description}

\section{Reading Lines}

A line in a log file will look like

\begin{verbatim}
<message type>| <simulator time>|<model num>| <message>
\end{verbatim}

\begin{description}
\item[message type] is the level of the logging message. It can be one of three things
  \begin{enumerate}[1)]
    \item Error
    \item Info
    \item Debug
  \end{enumerate}
\item[simulator time] is the current time in ticks of the simulator when the
  message was produced.
\item[model num] is the model number of the simulation. The default value
  is 0, but it can be set to other numbers for merging log files.
\item[message] This is the actual debug message which can be a number of
  different things about the progression of the simulation. Two useful things to
  be aware of are:
  \begin{description}
  \item[Market ID]s are within square brackets, e.g., \texttt{[1]}.
  \item[Agent ID]s are positive, and are within parentheses, e.g., \texttt{(1)};
    each agent has a \emph{unique} agent ID.
  \end{description}
\end{description}

Note that within the \path{config} directory there is a file called
\path{env.properties}, which is used to specify the logging level. Log level 2
will be adequate for most debugging purposes.
%
While printing to \texttt{System.out} will be useful for initial debugging,
looking at the logs and observation files will be necessary in order to verify
that agents are behaving as expected.

\section{Configuration File}

The log file excerpted in the following sections is located at
\path{simulations_1_14-Oct-2013_15.56.06.txt}, and was generated using the
following \path{simulation_spec.json} file:

\lstinputlisting{\simspec}

\section{Simulation Initialization}

When a simulation is initialized, the following items are
specified: \begin{inparaenum}[1)] \item the name of the simulation, \item the
  random seed used to run the simulation, \item the full configuration, \item
  number and type of each market, and \item market ID. \end{inparaenum} For
example:

\lstinputlisting[lastline=5]{\logfile}

In the previous file each lines means:
\begin{description}
\item[\texttt{mySimulation}:] Is the name of the simulation. This is used in the
  observation file and give a unique name to a specific simulation.
\item[\texttt{Random Seed : -1282951707}:] This prints out the random seed used
  to generate this simulation.
\item[\texttt{Configuration :...}:] Is the entire \path{simulation_spec.json}
  file for this simulation.
\item[\texttt{Created Market : CDA [1]}:] Specifies that market 1 is a CDA
  market.
\end{description}

\section{Market simulation}

After markets are created the simulation begins running.
\begin{description}
\item[Agent Strategy:] An example of an agent strategy is present in line 8 of
  the log file:

  \lstinputlisting[firstline=8,lastline=8]{\logfile}
  
  Agent strategies can take many forms depending on the agent, but they'll
  mostly look something like the preceding line.

\item[Agent Submit Order:] When an agent submits a order it will take the form of:

\begin{verbatim}
<agent> (<price>, <quantity>) -> <market>
\end{verbatim}

where a negative quantity is used to indicate sell orders. An example can be found
on line 9 of the log file:

\lstinputlisting[firstline=9,lastline=9]{\logfile}

\item[Market Quote Update:] When a market updates its internal quote you'll see
  a line like the following:

\begin{verbatim}
<market> (Bid: <bid price>, Ask: <ask price>)
\end{verbatim}

If a bid or ask doesn't exist than instead of seeing a price you'll see a hyphen
(\texttt{-}). An example can be found in line 10 of the log file:

\lstinputlisting[firstline=10,lastline=10]{\logfile}

Note this is the markets internal quote, and may not available to every agent
immediately.

\item[Transaction:] When two agents transact you'll see two lines like the
  following:

\begin{verbatim}
<agent1> transacted to position <position1>
<agent2> transacted to position <position2>
\end{verbatim}

An example can be found on lines 49 and 50 of the log file:

\lstinputlisting[firstline=49,lastline=50]{\logfile}

\item[NBBO Update:] After enough time has a passed a market's quote update will
  propagate to the NBBO. This will look like:

\begin{verbatim}
<market> -> SIP quote (Bid: <bid>, Ask: <offer>)
\end{verbatim}

Where bid and offer are the updated values that the SIP is getting. An example
can be found on line 77 of the log file:

\lstinputlisting[firstline=77,lastline=77]{\logfile}

\item[SIP Order Routing:] When an order comes in that can be routed for better
  execution at another market according to the NBBO you'll see a line like line
  97 in the log file:

  \lstinputlisting[firstline=97,lastline=97]{\logfile}

  which indicates the price disparities that caused the routing.

\item[Latency Arbitrage:] When latency arbitrage exists you'll see a series of
  log messages like the following output from like 13 to line 22 in the log file:

  \lstinputlisting[firstline=13,lastline=22]{\logfile}

  It starts with a market updating its quote and exposing an arbitrage
  opportunity. The Latency Arbitrageur (LA) will then announce that it detected
  the arbitrage and what follows is subsequent bids being placed and
  transactions that will leave the LA at net position 0.

\end{description}

\end{document}
